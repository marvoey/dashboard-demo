---
// DATA SOURCE: SQL Server (member_claims table)
//
// FETCH CALL â€” GET /api/member/claims/recent?limit=5
// Called on component mount with the member's session token.
//
//   useEffect(() => {
//     fetch('/api/member/claims/recent?limit=5', {
//       headers: { Authorization: `Bearer ${getSessionToken()}` }
//     })
//       .then(r => r.json())
//       .then(({ claims }) => setClaims(claims));
//   }, []);
//
// SERVER-SIDE QUERY:
//   SELECT TOP 5 claim_type, submitted_date, claim_amount, claim_status
//   FROM member_claims
//   WHERE member_id = @memberId
//   ORDER BY submitted_date DESC
//
// Returns the 5 most recent claims ordered by submission date.
// Row-level security enforced by the gateway â€” members see only their own claims.

interface Claim {
  type: string;
  submittedDate: string;
  amount: string;
  status: 'Paid' | 'In Review' | 'Pending';
}
interface Props {
  claims: Claim[];
}
const { claims } = Astro.props;
// â†‘ prototype: hardcoded array passed from the page
// â†‘ production: populated from GET /api/member/claims/recent response via useState
---

<div class="comp comp-table">
  <div class="comp-bar">
    <div class="comp-bar-left">
      <a href="/components/data/claims-list" target="_blank" class="comp-explain-link">ðŸ—„ Data Table â†—</a>
      <span style="opacity:0.4;">Â·</span>
      <span style="font-weight:500; text-transform:none; letter-spacing:0;">SQL Server</span>
    </div>
    <span class="data-source">ðŸ—„ SQL Server</span>
  </div>
  <div class="comp-body-flush">
    <div style="padding: 14px 16px; border-bottom: 1px solid var(--border);">
      <span class="card-title">Recent Claims</span>
    </div>
    <div style="padding: 0 16px;">
      {claims.map(c => (
        <div class="claim-row">
          <div>
            <div class="claim-type">{c.type}</div>
            <div class="claim-date">Submitted {c.submittedDate}</div>
          </div>
          <div style="text-align: right;">
            <div class="claim-amount" data-live>{c.amount}</div>
            <span class={`status ${c.status === 'Paid' ? 'status-active' : 'status-pending'}`} style="margin-top: 4px; display: inline-flex;">{c.status}</span>
          </div>
        </div>
      ))}
    </div>
  </div>
</div>
