---
// DATA SOURCE: SQL Server (member_policies table)
//
// FETCH CALL â€” GET /api/member/policies?status=active
// Called on component mount with the member's session token.
//
//   useEffect(() => {
//     fetch('/api/member/policies?status=active', {
//       headers: { Authorization: `Bearer ${getSessionToken()}` }
//     })
//       .then(r => r.json())
//       .then(({ policies }) => setPolicies(policies));
//   }, []);
//
// SERVER-SIDE QUERY:
//   SELECT product_name, policy_id, member_premium, coverage_amount
//   FROM member_policies
//   WHERE member_id = @memberId AND policy_status = @status
//   ORDER BY product_name ASC
//
// Filters to active policies by default. Terminated or lapsed policies
// are excluded unless the status query parameter is changed.
// Row-level security enforced by the gateway â€” members see only their own policies.

interface Policy {
  product: string;
  policyId: string;
  premium: string;
  coverageAmount: string;
}
interface Props {
  policies: Policy[];
}
const { policies } = Astro.props;
// â†‘ prototype: hardcoded array passed from the page
// â†‘ production: populated from GET /api/member/policies response via useState
---

<div class="comp comp-table span-2">
  <div class="comp-bar">
    <div class="comp-bar-left">
      <a href="/components/data/policy-list" target="_blank" class="comp-explain-link">ðŸ—„ Data Table â†—</a>
      <span style="opacity:0.4;">Â·</span>
      <span style="font-weight:500; text-transform:none; letter-spacing:0;">SQL Server</span>
    </div>
    <span class="data-source">ðŸ—„ SQL Server</span>
  </div>
  <div class="comp-body-flush">
    <div style="padding: 14px 16px; border-bottom: 1px solid var(--border);">
      <span class="card-title">My Active Policies</span>
    </div>
    {policies.map(p => (
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; border-bottom: 1px solid var(--border);">
        <div>
          <div style="font-size: 13.5px; font-weight: 500; color: var(--navy);">{p.product}</div>
          <div class="mono" style="margin-top: 2px;">{p.policyId}</div>
        </div>
        <div style="text-align: right;">
          <div style="font-size: 0.875rem; font-weight: 600; color: var(--navy);" data-live>{p.premium}</div>
          <div style="font-size: 0.6875rem; color: var(--text-muted); margin-top: 2px;">Coverage: {p.coverageAmount}</div>
        </div>
      </div>
    ))}
  </div>
</div>
