---
// DATA SOURCE: SQL Server (employer_enrollments table, aggregated by product)
//
// FETCH CALL â€” GET /api/employer/enrollment
// Called on component mount with the employer's session token.
//
//   useEffect(() => {
//     fetch('/api/employer/enrollment', {
//       headers: { Authorization: `Bearer ${getSessionToken()}` }
//     })
//       .then(r => r.json())
//       .then(({ products }) => setProducts(products));
//   }, []);
//
// SERVER-SIDE QUERY:
//   SELECT product_name,
//          COUNT(DISTINCT employee_id) AS enrolled_count,
//          SUM(monthly_premium)        AS total_premium
//   FROM employer_enrollments
//   WHERE employer_id = @employerId AND status = 'active'
//   GROUP BY product_name
//   ORDER BY total_premium DESC
//
// Filters to active enrollments only. New product lines appear automatically
// as soon as enrollment records exist for them â€” no code change needed.

interface Product {
  name: string;
  enrolled: number;
  premium: string;
}
interface Props {
  products: Product[];
}
const { products } = Astro.props;
// â†‘ prototype: hardcoded array passed from the page
// â†‘ production: populated from GET /api/employer/enrollment response via useState
---

<div class="comp comp-table span-2">
  <div class="comp-bar">
    <div class="comp-bar-left">
      <a href="/components/data/enrollment-table" target="_blank" class="comp-explain-link">ðŸ—„ Data Table â†—</a>
      <span style="opacity:0.4;">Â·</span>
      <span style="font-weight:500; text-transform:none; letter-spacing:0;">SQL Server</span>
    </div>
    <span class="data-source">ðŸ—„ SQL Server</span>
  </div>
  <div class="comp-body-flush">
    <div style="padding: 14px 16px; border-bottom: 1px solid var(--border);">
      <span class="card-title">Enrollment by Product</span>
    </div>
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Enrolled</th>
          <th>Monthly Premium</th>
        </tr>
      </thead>
      <tbody>
        {products.map(p => (
          <tr>
            <td style="font-weight: 500;">{p.name}</td>
            <td><span data-live>{p.enrolled}</span> <span style="color: var(--text-muted); font-size: 0.75rem;">employees</span></td>
            <td style="font-weight: 500;" data-live>{p.premium}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</div>
