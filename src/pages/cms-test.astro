---
import { cmsClient } from '../lib/cms';

const SIMPLE_QUERY = `{ __typename }`;

type ProbeResult = { ok: true; data: unknown; ms: number } | { ok: false; error: string; ms: number };

const start = performance.now();
let result: ProbeResult;
try {
  const data = await cmsClient.request(SIMPLE_QUERY, {});
  result = { ok: true, data, ms: Math.round(performance.now() - start) };
} catch (e) {
  result = { ok: false, error: String(e), ms: Math.round(performance.now() - start) };
}
---

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMS Client Test</title>
  <style>
    body { font-family: monospace; padding: 2rem; background: #0f0f0f; color: #e0e0e0; }
    h1 { color: #fff; margin-bottom: 2rem; }
    h2 { color: #aaa; border-bottom: 1px solid #333; padding-bottom: 0.5rem; margin-top: 2rem; }
    .card { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 6px; padding: 1rem 1.5rem; margin: 1rem 0; }
    .row { display: flex; gap: 1rem; align-items: baseline; margin: 0.4rem 0; }
    .label { color: #888; width: 180px; flex-shrink: 0; }
    .ok { color: #4caf50; }
    .err { color: #f44336; }
    pre { background: #111; padding: 0.75rem; border-radius: 4px; overflow-x: auto; font-size: 0.8em; color: #ccc; }
  </style>
</head>
<body>
  <h1>CMS Client Test</h1>

  <h2>cmsClient — single key</h2>
  <div class="card">
    <div class="row">
      <span class="label">Status</span>
      <span class={result.ok ? 'ok' : 'err'}>{result.ok ? '✓ Connected' : '✗ Failed'}</span>
    </div>
    <div class="row">
      <span class="label">Response time</span>
      <span>{result.ms}ms</span>
    </div>
    {result.ok
      ? <div class="row"><span class="label">Response</span><pre>{JSON.stringify(result.data, null, 2)}</pre></div>
      : <div class="row"><span class="label">Error</span><span class="err">{result.error}</span></div>
    }
  </div>
</body>
</html>
